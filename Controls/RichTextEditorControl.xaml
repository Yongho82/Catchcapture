<UserControl x:Class="CatchCapture.Controls.RichTextEditorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <!-- Icon Data -->
        <Geometry x:Key="IconBold">M4,4.5C4,4.22 4.22,4 4.5,4h5.16c1.84,0 3.34,1.5 3.34,3.34 0,0.97 -0.41,1.84 -1.04,2.47 0.65,0.71 1.04,1.65 1.04,2.69 0,2.21 -1.79,4 -4,4H5.5C4.67,16.5 4,15.83 4,15V4.5z M5.5,10h4.21c0.72,0 1.29,-0.61 1.29,-1.33 0,-0.74 -0.6,-1.34 -1.34,-1.34H5.5V10z M5.5,15h4c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2h-4V15z</Geometry>
        <Geometry x:Key="IconItalic">M12,4c0.55,0 1,0.45 1,1c0,0.1 -0.02,0.2 -0.05,0.29l-3.34,10h2.39c0.55,0 1,0.45 1,1s-0.45,1 -1,1h-7c-0.55,0 -1,-0.45 -1,-1s0.45,-1 1,-1h2.15l3.34,-10H8c-0.55,0 -1,-0.45 -1,-1s0.45,-1 1,-1H12z</Geometry>
        <Geometry x:Key="IconUnderline">M12,17c-3.31,0 -6,-2.69 -6,-6V4c0,-0.55 0.45,-1 1,-1h0.5c0.55,0 1,0.45 1,1v7c0,1.93 1.57,3.5 3.5,3.5s3.5,-1.57 3.5,-3.5V4c0,-0.55 0.45,-1 1,-1h0.5c0.55,0 1,0.45 1,1v7C18,14.31 15.31,17 12,17z M5,18.5c0,-0.55 0.45,-1 1,-1h12c0.55,0 1,0.45 1,1s-0.45,1 -1,1H6C5.45,19.5 5,19.05 5,18.5z</Geometry>
        <Geometry x:Key="IconAlignLeft">M3,5.5C3,5.22 3.22,5 3.5,5h13c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-13C3.22,6 3,5.78 3,5.5z M3,9.5C3,9.22 3.22,9 3.5,9H11c0.28,0 0.5,0.22 0.5,0.5S11.28,10 11,10H3.5C3.22,10 3,9.78 3,9.5z M3,13.5C3,13.22 3.22,13 3.5,13h13c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-13C3.22,14 3,13.78 3,13.5z M3,17.5C3,17.22 3.22,17 3.5,17H9C9.28,17 9.5,17.22 9.5,17.5s-0.22,0.5 -0.5,0.5H3.5C3.22,18 3,17.78 3,17.5z</Geometry>
        <Geometry x:Key="IconAlignCenter">M3.5,5.5C3.5,5.22 3.72,5 4,5h12c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-12C3.72,6 3.5,5.78 3.5,5.5z M6,9.5C6,9.22 6.22,9 6.5,9H13.5c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5H6.5C6.22,10 6,9.78 6,9.5z M3.5,13.5C3.5,13.22 3.72,13 4,13h12c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-12C3.72,14 3.5,13.78 3.5,13.5z M7,17.5C7,17.22 7.22,17 7.5,17H12.5c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5H7.5C7.22,18 7,17.78 7,17.5z</Geometry>
        <Geometry x:Key="IconAlignRight">M3.5,5.5C3.5,5.22 3.72,5 4,5h12c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-12C3.72,6 3.5,5.78 3.5,5.5z M8.5,9.5C8.5,9.22 8.72,9 9,9h7.5c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-7.5C8.72,10 8.5,9.78 8.5,9.5z M3.5,13.5C3.5,13.22 3.72,13 4,13h12c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-12C3.72,14 3.5,13.78 3.5,13.5z M10.5,17.5C10.5,17.22 10.72,17 11,17h5.5c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-5.5C10.72,18 10.5,17.78 10.5,17.5z</Geometry>
        <Geometry x:Key="IconListBullet">M7.5,5.5C7.5,5.22 7.72,5 8,5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,6 7.5,5.78 7.5,5.5z M4,6c0.55,0 1,-0.45 1,-1s-0.45,-1 -1,-1s-1,0.45 -1,1s0.45,1 1,1z M7.5,11.5c0,-0.28 0.22,-0.5 0.5,-0.5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,12 7.5,11.78 7.5,11.5z M4,12c0.55,0 1,-0.45 1,-1s-0.45,-1 -1,-1s-1,0.45 -1,1s0.45,1 1,1z M7.5,17.5c0,-0.28 0.22,-0.5 0.5,-0.5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,18 7.5,17.78 7.5,17.5z M4,18c0.55,0 1,-0.45 1,-1s-0.45,-1 -1,-1s-1,0.45 -1,1s0.45,1 1,1z</Geometry>
        <Geometry x:Key="IconListNumber">M7.5,5.5C7.5,5.22 7.72,5 8,5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,6 7.5,5.78 7.5,5.5z M3.5,4h2v1h-1v2.5h-1v-2h-1V4.5h1V4z M7.5,11.5c0,-0.28 0.22,-0.5 0.5,-0.5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,12 7.5,11.78 7.5,11.5z M3,10.2c0,-0.11 0.09,-0.2 0.2,-0.2h1.6c0.11,0 0.2,0.09 0.2,0.2v0.3l-1.3,1.3h1.3c0.11,0 0.2,0.09 0.2,0.2s-0.09,0.2 -0.2,0.2H3.5c-0.11,0 -0.2,-0.09 -0.2,-0.2s0.09,-0.2 0.2,-0.2l1.1,-1.1H3.2c-0.11,0 -0.2,-0.09 -0.2,-0.2v-0.3z M7.5,17.5c0,-0.28 0.22,-0.5 0.5,-0.5h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C7.72,18 7.5,17.78 7.5,17.5z M3,16.2c0,-0.11 0.09,-0.2 0.2,-0.2h1.6c0.11,0 0.2,0.09 0.2,0.2s-0.09,0.2 -0.2,0.2H3.5l1.5,1v0.7c0,0.11 -0.09,0.2 -0.2,0.2H3.2c-0.11,0 -0.2,-0.09 -0.2,-0.2s0.09,-0.2 0.2,-0.2h1v-0.3l-1,-0.7v-0.7z</Geometry>
        <Geometry x:Key="IconImage">M4.5,3C3.67,3 3,3.67 3,4.5v11c0,0.83 0.67,1.5 1.5,1.5h11c0.83,0 1.5,-0.67 1.5,-1.5v-11C17,3.67 16.33,3 15.5,3H4.5z M4.5,4h11C15.78,4 16,4.22 16,4.5v7.29l-3.14,-3.14c-0.2,-0.2 -0.51,-0.2 -0.71,0l-3.65,3.65l-1.65,-1.65c-0.2,-0.2 -0.51,-0.2 -0.71,0L4,12.79V4.5C4,4.22 4.22,4 4.5,4z</Geometry>
        <Geometry x:Key="IconLink">M10.83,5.17c-1.56,-1.56 -4.09,-1.56 -5.66,0l-1,1c-1.56,1.56 -1.56,4.09 0,5.66l1.17,1.17c0.2,0.2 0.51,0.2 0.71,0s0.2,-0.51 0,-0.71l-1.17,-1.17c-1.17,-1.17 -1.17,-3.07 0,-4.24l1,-1c1.17,-1.17 3.07,-1.17 4.24,0l2,2c1.17,1.17 1.17,3.07 0,4.24l-0.5,0.5c-0.2,0.2 -0.2,0.51 0,0.71s0.51,0.2 0.71,0l0.5,-0.5c1.56,-1.56 1.56,-4.09 0,-5.66l-2,-2z M7,13c-0.28,0 -0.5,0.22 -0.5,0.5s0.22,0.5 0.5,0.5h6c0.28,0 0.5,-0.22 0.5,-0.5s-0.22,-0.5 -0.5,-0.5H7z M15,13.17c-0.2,-0.2 -0.51,-0.2 -0.71,0s-0.2,0.51 0,0.71l1,1.17c1.17,1.17 1.17,3.07 0,4.24l-1,1c-1.17,1.17 -3.07,1.17 -4.24,0l-2,-2c-1.17,-1.17 -1.17,-3.07 0,-4.24l0.5,-0.5c0.2,-0.2 0.2,-0.51 0,-0.71s-0.51,-0.2 -0.71,0l-0.5,0.5c-1.56,1.56 -1.56,4.09 0,5.66l2,2c1.56,1.56 4.09,1.56 5.66,0l1,-1c1.56,-1.56 1.56,-4.09 0,-5.66l-1,-1.17z</Geometry>
        <Geometry x:Key="IconTextColor">M4,17.5C4,17.22 4.22,17 4.5,17h11c0.28,0 0.5,0.22 0.5,0.5s-0.22,0.5 -0.5,0.5h-11C4.22,18 4,17.78 4,17.5z M10,3c0.18,0 0.35,0.1 0.44,0.26l5.5,10c0.1,0.19 0.03,0.43 -0.16,0.53s-0.43,0.03 -0.53,-0.16l-1.37,-2.5H6.12l-1.37,2.5c-0.1,0.19 -0.34,0.26 -0.53,0.16S3.96,13.96 4.06,13.77l5.5,-10C9.65,3.1 9.82,3 10,3z M6.67,10.13h6.66l-3.33,-6.06L6.67,10.13z</Geometry>
        <Geometry x:Key="IconHighlight">M17,11c0.55,0 1,-0.45 1,-1s-0.45,-1 -1,-1s-1,0.45 -1,1s0.45,1 1,1z M15,4c0.55,0 1,-0.45 1,-1s-0.45,-1 -1,-1s-1,0.45 -1,1s0.45,1 1,1z M8,13.5L3.5,18L2,17l4.5,-4.5c0.3,-0.3 0.7,-0.3 1,0l0.5,0.5c0.3,0.3 0.3,0.7 0,1z M18.5,8.5L8.5,18.5c-0.4,0.4 -1,0.4 -1.4,0L2,13.4c-0.4,-0.4 -0.4,-1 0,-1.4l10,-10c0.4,-0.4 1,-0.4 1.4,0l5.1,5.1C18.9,7.5 18.9,8.1 18.5,8.5z M12.8,4.1l-8.7,8.7l3.7,3.7l8.7,-8.7L12.8,4.1z</Geometry>
        <Geometry x:Key="IconUndo">M3,5.5Q3,5 3.5,5h4Q8,5 8,5.5v2.3C9.2,6.5 10.5,5.8 12,5.8q3.3,0 5.6,2.3t2.3,5.6q0,3.3 -2.3,5.6T12,21.6q-3.3,0 -5.6,-2.3l0.7,-0.7q2,2 4.9,2t4.9,-2t2,-4.9t-2,-4.9t-4.9,-2c-1.4,0 -2.6,0.6 -3.5,1.5h2.4q0.5,0 0.5,0.5s-0.5,0.5 -0.5,0.5h-4Q3.5,11.3 3,11.3v-4q0,-0.5 0.5,-0.5s0.5,0.5 0.5,0.5v2.3z</Geometry>
        <Geometry x:Key="IconRedo">M21,5.5Q21,5 20.5,5h-4Q16,5 16,5.5v2.3C14.8,6.5 13.5,5.8 12,5.8q-3.3,0 -5.6,2.3t-2.3,5.6q0,3.3 2.3,5.6T12,21.6q3.3,0 5.6,-2.3l-0.7,-0.7q-2,2 -4.9,2t-4.9,-2t-2,-4.9t2,-4.9t4.9,-2c1.4,0 2.6,0.6 3.5,1.5h-2.4q-0.5,0 -0.5,0.5s0.5,0.5 0.5,0.5h4Q20.5,11.3 21,11.3v-4q0,-0.5 -0.5,-0.5s-0.5,0.5 -0.5,0.5v2.3z</Geometry>
        <Geometry x:Key="IconLineSpacing">M3.5,5C3.22,5 3,5.22 3,5.5S3.22,6 3.5,6h13c0.28,0 0.5,-0.22 0.5,-0.5s-0.22,-0.5 -0.5,-0.5h-13z M3.5,9C3.22,9 3,9.22 3,9.5S3.22,10 3.5,10h13c0.28,0 0.5,-0.22 0.5,-0.5s-0.22,-0.5 -0.5,-0.5h-13z M3.5,13C3.22,13 3,13.22 3,13.5S3.22,14 3.5,14h13c0.28,0 0.5,-0.22 0.5,-0.5s-0.22,-0.5 -0.5,-0.5h-13z M3.5,17C3.22,17 3,17.22 3,17.5S3.22,18 3.5,18h13c0.28,0 0.5,-0.22 0.5,-0.5s-0.22,-0.5 -0.5,-0.5h-13z M18.5,11.5L20,13l1.5,-1.5 M18.5,8.5L20,7l1.5,1.5</Geometry>
        <Geometry x:Key="IconPage">M4.5,2C3.12,2,2,3.12,2,4.5v11C2,16.88,3.12,18,4.5,18h9c1.38,0,2.5-1.12,2.5-2.5v-11C16,3.12,14.88,2,13.5,2H4.5z M3,4.5 C3,3.67,3.67,3,4.5,3h9C14.33,3,15,3.67,15,4.5v11c0,0.83,-0.67,1.5,-1.5,1.5h-9C3.67,17,3,16.33,3,15.5V4.5z M5,6h8v1H5V6z M5,9h8v1H5V9z M5,12h5v1H5V12z</Geometry>

        <!-- Button Style -->
        <Style x:Key="EditorButtonStyle" TargetType="ButtonBase">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ButtonBase">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4" BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F0F3F4"/>
                            </Trigger>
                            <Trigger Property="ToggleButton.IsChecked" Value="True">
                                <Setter Property="Background" Value="#E5EAF5"/>
                                <Setter Property="BorderBrush" Value="#3498DB"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="EditorIconPath" TargetType="Path">
            <Setter Property="Fill" Value="#5F6368"/> <!-- Material Grey -->
            <Setter Property="Stretch" Value="Uniform"/>
            <Setter Property="Height" Value="14"/>
            <Setter Property="Width" Value="14"/>
        </Style>
    </UserControl.Resources>

    <Grid Background="White"> <!-- Main Background White -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <!-- Just a Bottom Border for separation -->
        <Border Grid.Row="0" Background="White" BorderBrush="#EEEEEE" BorderThickness="0,0,0,1" Padding="4,4,4,4">
            <WrapPanel>
                <!-- Font Family -->
                <ComboBox x:Name="CboFontFamily" Width="160" Height="26" VerticalContentAlignment="Center"
                          Background="White" Foreground="#333333" BorderBrush="#E0E0E0" Margin="0,1,6,1" 
                          SelectionChanged="CboFontFamily_SelectionChanged" ToolTip="글꼴" Focusable="False">
                     <ComboBox.Resources>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="CornerRadius" Value="4"/>
                        </Style>
                    </ComboBox.Resources>
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Source}" FontFamily="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Font Size -->
                <ComboBox x:Name="CboFontSize" Width="55" Height="26" VerticalContentAlignment="Center"
                          Background="White" Foreground="#333333" BorderBrush="#E0E0E0" Margin="0,1,6,1" 
                          SelectionChanged="CboFontSize_SelectionChanged" ToolTip="글자 크기" Focusable="False">
                    <ComboBox.Resources>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="CornerRadius" Value="4"/>
                        </Style>
                    </ComboBox.Resources>
                    <ComboBoxItem Content="10"/>
                    <ComboBoxItem Content="12"/>
                    <ComboBoxItem Content="14" IsSelected="True"/>
                    <ComboBoxItem Content="16"/>
                    <ComboBoxItem Content="18"/>
                    <ComboBoxItem Content="24"/>
                    <ComboBoxItem Content="36"/>
                </ComboBox>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Text Formatting -->
                <ToggleButton x:Name="BtnBold" Style="{StaticResource EditorButtonStyle}" Click="BtnBold_Click" ToolTip="굵게 (Ctrl+B)" Focusable="False">
                    <Path Data="{StaticResource IconBold}" Style="{StaticResource EditorIconPath}"/>
                </ToggleButton>
                <ToggleButton x:Name="BtnItalic" Style="{StaticResource EditorButtonStyle}" Click="BtnItalic_Click" ToolTip="기울임 (Ctrl+I)" Focusable="False">
                    <Path Data="{StaticResource IconItalic}" Style="{StaticResource EditorIconPath}"/>
                </ToggleButton>
                <ToggleButton x:Name="BtnUnderline" Style="{StaticResource EditorButtonStyle}" Click="BtnUnderline_Click" ToolTip="밑줄 (Ctrl+U)" Focusable="False">
                    <Path Data="{StaticResource IconUnderline}" Style="{StaticResource EditorIconPath}"/>
                </ToggleButton>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Text Color -->
                <Button x:Name="BtnTextColor" Style="{StaticResource EditorButtonStyle}" Click="BtnTextColor_Click" ToolTip="글자 색상" Focusable="False">
                    <StackPanel>
                        <Path Data="{StaticResource IconTextColor}" Style="{StaticResource EditorIconPath}" Fill="#E74C3C"/>
                    </StackPanel>
                </Button>
                <Button x:Name="BtnHighlight" Style="{StaticResource EditorButtonStyle}" Click="BtnHighlight_Click" ToolTip="배경 색상 (형광펜)" Focusable="False">
                    <Path Data="{StaticResource IconHighlight}" Style="{StaticResource EditorIconPath}" Fill="#F1C40F"/>
                </Button>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Alignment -->
                <Button x:Name="BtnAlignLeft" Style="{StaticResource EditorButtonStyle}" Click="BtnAlignLeft_Click" ToolTip="왼쪽 정렬" Focusable="False">
                    <Path Data="{StaticResource IconAlignLeft}" Style="{StaticResource EditorIconPath}"/>
                </Button>
                <Button x:Name="BtnAlignCenter" Style="{StaticResource EditorButtonStyle}" Click="BtnAlignCenter_Click" ToolTip="가운데 정렬" Focusable="False">
                    <Path Data="{StaticResource IconAlignCenter}" Style="{StaticResource EditorIconPath}"/>
                </Button>
                <Button x:Name="BtnAlignRight" Style="{StaticResource EditorButtonStyle}" Click="BtnAlignRight_Click" ToolTip="오른쪽 정렬" Focusable="False">
                    <Path Data="{StaticResource IconAlignRight}" Style="{StaticResource EditorIconPath}"/>
                </Button>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Lists -->
                <Button x:Name="BtnBulletList" Style="{StaticResource EditorButtonStyle}" Click="BtnBulletList_Click" ToolTip="글머리 기호" Focusable="False">
                    <Path Data="{StaticResource IconListBullet}" Style="{StaticResource EditorIconPath}"/>
                </Button>
                <Button x:Name="BtnNumberList" Style="{StaticResource EditorButtonStyle}" Click="BtnNumberList_Click" ToolTip="번호 매기기" Focusable="False">
                    <Path Data="{StaticResource IconListNumber}" Style="{StaticResource EditorIconPath}"/>
                </Button>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Insert -->
                <Button x:Name="BtnInsertImage" Style="{StaticResource EditorButtonStyle}" Click="BtnInsertImage_Click" ToolTip="이미지 삽입" Focusable="False">
                    <Path Data="{StaticResource IconImage}" Style="{StaticResource EditorIconPath}"/>
                </Button>
                <Button x:Name="BtnInsertLink" Style="{StaticResource EditorButtonStyle}" Click="BtnInsertLink_Click" ToolTip="링크 삽입" Focusable="False">
                    <Path Data="{StaticResource IconLink}" Style="{StaticResource EditorIconPath}"/>
                </Button>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Undo/Redo -->
                <Button x:Name="BtnUndo" Style="{StaticResource EditorButtonStyle}" Click="BtnUndo_Click" ToolTip="실행 취소 (Ctrl+Z)" Focusable="False">
                    <Path Data="{StaticResource IconUndo}" Style="{StaticResource EditorIconPath}"/>
                </Button>
                <Button x:Name="BtnRedo" Style="{StaticResource EditorButtonStyle}" Click="BtnRedo_Click" ToolTip="다시 실행 (Ctrl+Y)" Focusable="False">
                    <Path Data="{StaticResource IconRedo}" Style="{StaticResource EditorIconPath}"/>
                </Button>

                <Separator Width="1" Height="16" Background="#EEEEEE" Margin="4,0" VerticalAlignment="Center"/>

                <!-- Line Spacing -->
                <Button x:Name="BtnLineSpacing" Style="{StaticResource EditorButtonStyle}" Click="BtnLineSpacing_Click" ToolTip="줄 간격" Focusable="False">
                    <Path Data="{StaticResource IconLineSpacing}" Style="{StaticResource EditorIconPath}"/>
                    <Button.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="1.0 (좁게)" Click="BtnLineSpacingSingle_Click"/>
                            <MenuItem Header="1.5 (기본)" Click="BtnLineSpacing15_Click"/>
                            <MenuItem Header="2.0 (넓게)" Click="BtnLineSpacingDouble_Click"/>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>

            </WrapPanel>
        </Border>

        <!-- Editor: Removed borders, just pure content area -->
        <Grid Grid.Row="1">
            <RichTextBox x:Name="RtbEditor" TextChanged="RtbEditor_TextChanged" GotFocus="RtbEditor_GotFocus" LostFocus="RtbEditor_LostFocus" Loaded="RtbEditor_Loaded" 
                         Background="White" 
                         Foreground="#333333" 
                         BorderThickness="0" 
                         FontSize="15" 
                         AcceptsReturn="True" 
                         Padding="20"
                         CaretBrush="Black"
                         SelectionBrush="#303498DB"
                         SelectionOpacity="0.3"
                         VerticalScrollBarVisibility="Auto"
                         IsDocumentEnabled="True"
                         SpellCheck.IsEnabled="False"
                         TextOptions.TextFormattingMode="Ideal"
                         TextOptions.TextRenderingMode="ClearType"
                         RenderOptions.ClearTypeHint="Enabled">
                <FlowDocument IsOptimalParagraphEnabled="False" PagePadding="0">
                    <Paragraph></Paragraph>
                </FlowDocument>
            </RichTextBox>
        </Grid>

        <!-- Color Picker Popup -->
        <Popup x:Name="ColorPickerPopup" StaysOpen="False" AllowsTransparency="True">
            <Border Background="#FF2A2A2A" BorderBrush="#FF555555" BorderThickness="1" CornerRadius="4" Padding="10">
                <StackPanel>
                    <TextBlock Text="색상 선택" Foreground="White" FontSize="12" Margin="0,0,0,8"/>
                    <UniformGrid Columns="8">
                        <Button Background="Black" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF000000"/>
                        <Button Background="#FF333333" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF333333"/>
                        <Button Background="#FF666666" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF666666"/>
                        <Button Background="White" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FFFFFFFF"/>
                        <Button Background="Red" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FFFF0000"/>
                        <Button Background="Orange" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FFFF8800"/>
                        <Button Background="Yellow" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FFFFFF00"/>
                        <Button Background="Green" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF00FF00"/>
                        <Button Background="Blue" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF0000FF"/>
                        <Button Background="Purple" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF8800FF"/>
                        <Button Background="Pink" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FFFF00FF"/>
                        <Button Background="Cyan" Width="24" Height="24" Margin="2" Click="ColorButton_Click" Tag="#FF00FFFF"/>
                    </UniformGrid>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</UserControl>
